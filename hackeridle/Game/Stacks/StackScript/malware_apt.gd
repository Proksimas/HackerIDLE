extends StackScript

func execute() -> Dictionary:
	if targets.is_empty():
		return {
			"caster": caster,
			"action_type": "Damage",
			"targetEffects": []
		}

	var target: Entity = targets[0]

	# Dégâts immédiats (faibles)
	var base_damage: int = int(calcul_effect_value(caster))
	# Statut Malware (DoT stackable)
	var status := {
		"id": "Malware",
		"display_name": "Malware",
		"type": "DoT",
		# dégâts PAR STACK et PAR TICK
		"value": int(base_damage * 0.3), # 30% par tick
		# durée
		"turns": 3,
		# stacking
		"stackMode": "AddStack",
		"refreshMode": "Refresh",
		"addStacks": 1,
		"maxStacks": 5,
		# provenance
		"source": caster
	}

	return {
		"caster": caster,
		"action_type": "Damage",
		"targetEffects": [
			{
				"target": target,
				"effects": [
					# dégâts immédiats
					{"type": "HP", "value": base_damage},
					# application du DoT
					{"type": "ApplyStatus", "status": status}
				]
			}
		]
	}
